<html>
<head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-org-chart@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-flextree@2.1.2/build/d3-flextree.js"></script>
    <!-- ORG CHART -->
    <div class="charts">
        <div
        class="org-chart-container"
        style="height: 1200px; background-color: black"
        >
        </div>
        <div
        class="known-associates-container"
        style="height: 1200px; background-color: black"
        >
        </div>
    </div>

    <script>
        var chart;
        d3.csv(
        'assets/data/org.csv'
        ).then((dataFlattened) => {
            chart = new d3.OrgChart()
            .container('.org-chart-container')
            .data(dataFlattened)
            .rootMargin(100)
            .nodeWidth((d) => 210)
            .nodeHeight((d) => 170)
            .childrenMargin((d) => 130)
            .compactMarginBetween((d) => 75)
            .compactMarginPair((d) => 80)
            .linkUpdate(function (d, i, arr) {
                d3.select(this)
                .attr('stroke', (d) =>
                d.data._upToTheRootHighlighted ? '#152785' : 'lightgray'
                )
                .attr('stroke-width', (d) =>
                d.data._upToTheRootHighlighted ? 5 : 1.5
                )
                .attr('stroke-dasharray', '4,4');
                
                if (d.data._upToTheRootHighlighted) {
                    d3.select(this).raise();
                }
            })
            .nodeContent(function (d, i, arr, state) {
                const colors = [
                '#222222',
                '#666666',
                '#F45754',
                '#96C62C',
                '#BD7E16',
                '#802F74',
                ];
                const color = colors[d.depth % colors.length];
                const imageDim = 80;
                const lightCircleDim = 95;
                const outsideCircleDim = 110;
                
                return `
                    <div style="background-color:#888888; position:absolute;width:${
                d.width
                }px;height:${d.height}px;">
                    <div style="background-color:${color};position:absolute;margin-top:-${outsideCircleDim / 2}px;margin-left:${d.width / 2 - outsideCircleDim / 2}px;border-radius:0;width:${outsideCircleDim}px;height:${outsideCircleDim}px;"></div>
                    <div style="background-color:#000000;position:absolute;margin-top:-${
                lightCircleDim / 2
                }px;margin-left:${d.width / 2 - lightCircleDim / 2}px;border-radius:0;width:${lightCircleDim}px;height:${lightCircleDim}px;"></div>
                    <img src=" ${
                d.data.imageUrl
                }" style="position:absolute;margin-top:-${imageDim / 2}px;margin-left:${d.width / 2 - imageDim / 2}px;border-radius:0;width:${imageDim}px;height:${imageDim}px;" />
                    <div class="card" style="top:${
                outsideCircleDim / 2 + 10
                }px;position:absolute;height:30px;width:${d.width}px;background-color:#3AB6E3;">
                        <div style="background-color:${color};height:28px;text-align:center;padding-top:10px;color:#ffffff;font-weight:bold;font-size:16px">
                            ${d.data.name} 
                        </div>
                        <div style="background-color:#444444;height:28px;text-align:center;padding-top:10px;color:#ffffff;font-size:16px">
                            ${d.data.positionName} 
                        </div>
                        <div style="background-color:#444444;height:24px;text-align:center;padding-top:2px;color:#ffffff;font-size:14px;font-style:italic">
                            ${d.data.positionSubtitle} 
                        </div>
                    </div>
                </div>
    `;
            })
            .render();
        });
    </script>

    <script>
        var chart;
        d3.csv(
        'assets/data/associates.csv'
        ).then((dataFlattened) => {
            chart = new d3.OrgChart()
            .container('.known-associates-container')
            .data(dataFlattened)
            .rootMargin(100)
            .nodeWidth((d) => 250)
            .nodeHeight((d) => 100)
            .childrenMargin((d) => 130)
            .compactMarginBetween((d) => 75)
            .compactMarginPair((d) => 80)
            .linkUpdate(function (d, i, arr) {
                d3.select(this)
                .attr('stroke', (d) =>
                d.data._upToTheRootHighlighted ? '#152785' : 'lightgray'
                )
                .attr('stroke-width', (d) =>
                d.data._upToTheRootHighlighted ? 5 : 1.5
                )
                .attr('stroke-dasharray', '4,4');
                
                if (d.data._upToTheRootHighlighted) {
                    d3.select(this).raise();
                }
            })
            .nodeContent(function (d, i, arr, state) {
                const colors = [
                '#222222',
                '#666666',
                '#F45754',
                '#96C62C',
                '#BD7E16',
                '#802F74',
                ];
                const color = colors[d.depth % colors.length];
                const imageDim = 80;
                const lightCircleDim = 95;
                const outsideCircleDim = 110;
                
                return d.data.imageUrl ? 
                `<div style="background-color:#888888; position:absolute;width:${
                d.width
                }px;height:${d.height}px;">
                    <div style="background-color:${color};position:absolute;margin-top:-${outsideCircleDim / 2}px;margin-left:${d.width / 2 - outsideCircleDim / 2}px;border-radius:0;width:${outsideCircleDim}px;height:${outsideCircleDim}px;"></div>
                    <div style="background-color:#000000;position:absolute;margin-top:-${
                lightCircleDim / 2
                }px;margin-left:${d.width / 2 - lightCircleDim / 2}px;border-radius:0;width:${lightCircleDim}px;height:${lightCircleDim}px;"></div>
                    <img src=" ${
                d.data.imageUrl
                }" style="position:absolute;margin-top:-${imageDim / 2}px;margin-left:${d.width / 2 - imageDim / 2}px;border-radius:0;width:${imageDim}px;height:${imageDim}px;" />
                    <div class="card" style="top:${
                outsideCircleDim / 2 + 10
                }px;position:absolute;height:30px;width:${d.width}px;background-color:#3AB6E3;">
                        <div style="background-color:${color};height:28px;text-align:center;padding-top:10px;color:#ffffff;font-weight:bold;font-size:16px">
                            ${d.data.name} 
                        </div>
                    </div>
                </div>` :
                `<div style="background-color:#888888; position:absolute;width:${
                d.width
                }px;height:${d.height - 100}px;">
                    <div class="card" style="position:absolute;height:30px;width:${d.width}px;background-color:#3AB6E3;">
                        <div style="background-color:${color};height:28px;text-align:center;padding-top:10px;color:#ffffff;font-weight:bold;font-size:16px">
                            ${d.data.name} 
                        </div>
                    </div>
                </div>`;
            })
            .render();
        });
    </script>
</body>
</html>
